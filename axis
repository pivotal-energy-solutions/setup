BRANCH=bin/setup
GITHUB_TOKEN=${1:-GITHUB_TOKEN}

if [[ -e axis ]]; then
  if [[ -e bin/django ]]; then
    bin/setup
  else
    axis/bin/setup
  fi
else
  echo
  echo "Cloning setup repository..."
  git clone https://github.com/pivotal-energy-solutions/setup.git

  echo
  echo "NOTE: Use ./setup/axis to continue this process if anything goes wrong!"

  if ! [ "x$GITHUB_TOKEN" == "x" ]; then
    echo 'Generate a GitHub personal access token on the following page with full private access to `pivotal-energy-solutions/axis`':
    echo
    echo '    https://github.com/settings/tokens'
    echo
    printf "Personal access token: "
    stty -echo
    read GITHUB_TOKEN
    stty echo
    printf "\n"
  fi
  bash <(curl -fsSL https://${GITHUB_TOKEN}@raw.githubusercontent.com/pivotal-energy-solutions/axis/${BRANCH}/bin/setup)
fi
